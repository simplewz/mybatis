###MyBatis的两级缓存
####一. 一级缓存

#####1. 一级缓存的含义

Mybatis的一级缓存也叫**本地缓存**，它是SqlSession级别的缓存，MyBatis默认开启一级缓存。

SqlSession级别的缓存含义：与数据库同一次会话期间查询到的数据会放在一级缓存(本地缓存)中，以后如果需要获取相同的数据，直接从缓存中获取，不用再去查询数据库。

#####2. 一级缓存会失效的4种情况

(1) SqlSession发生了变化,即在不同的会话中查询相同的数据记录不会使用缓存。

(2) SqlSession相同，但是查询条件发生了变化，也不会使用缓存(原因条件发生变化后的查询记录还没有保存在缓存中)。

(3) SqlSession相同，但是两次查询期间执行过了增删改的操作，使缓存失效。

(4) SqlSession相同，手动调用了SqlSession的clearCache()方法清除了缓存使缓存失效。

####二. 二级缓存

#####1. 二级缓存的含义

   二级缓存也叫**全局缓存**,它是一个基于namespace级别的缓存，一个namespace对应一个二级缓存。
#####2. MyBatis的二级缓存工作机制
(1) 一个会话中查询的数据会被放在当前会话的一级缓存中。

(2) 如果会话关闭，一级缓存中的数据会被保存到二级缓存中。新的会话查询信息时，就可以参照二级缓存中内容。

(3) 在同一个会话中，如果查询出不同的数据记录，这些数据会被存放到各自对应的namespace的二级缓存中。

比如一个SqlSession会话中既使用EmployeeMapper查询出员工数据，又调用DepartmentMapper查询出部门数据，那么会话在关闭时如果开启了二级缓存，这些查询出的数据将会被缓存到各自对应的namespace级别的缓存中。

#####3. MyBatis的二级缓存使用
(1) 在MyBatis的配置文件开启二级缓存配置(MyBatis默认开启了二级缓存)。

```xml
<setting name="cacheEnabled" value="true"/>
```


(2) 在MyBatis的mapper映射文件中使用配置使用二级缓存。

```xml
 <cache
        eviction="LRU"
        flushInterval="3000"
        readOnly="true"
        size="512"
    />
```

缓存标签属性说明：

**eviction:** 缓存回收策略,默认配置为LRU。

    LRU：最近最少使用，移除最长时间不被使用的对象。
    FIFO:先进先出，按对象进入缓存的顺序来进行移除。
    SOFT:软引用，移除基于垃圾回收器状态和软引用规则的对象。
    WEAK:弱引用，更积极的移除 基于垃圾回收器状态和弱引用规则的对象。
**flushInterval：**缓存刷新间隔(单位:ms)，表示缓存多长时间清空一次。默认是不清空。
**readOnly:** 缓存是否只读，默认是非只读。
    只读：所有从缓存中获取数据的操作都是只读操作，不会修改数据。MyBatis为了加快获取缓存，
         直接就会将数据在缓存中的引用返回个用户。不安全，但是速度快。
    非只读：获取的数据可能被修改，mybatis会使用序列化反序列化技术克隆一份新的数据进行返回。
**size:** 缓存存放多少数据。
**type:** 缓存类型，一般使用缓存实现类的全类名。
    如果需要使用自定义缓存，则只需要自定义一个类实现Cache接口即可。

(3) 因为MyBatis的缓存使用的是非只读的方式，需要使用到序列化技术，所以在需要缓存的实体类上需要实现序列化接口。

**注意：开启二级缓存后，只有会话提交或者关闭后，一级缓存中的数据才会转移到二级缓存中。**

#### 三. MyBatis和缓存有关的设置

1. cacheEnabled=true，开启缓存。为false时关闭二级缓存，不关闭一级缓存。

2. 每个select语句的useCache属性默认为true,表示开启二级缓存，设置为false时是关闭二级缓存，不关闭一级缓存。

3. **每个增删改的flushCache="true"会将一级缓存和二级缓存都清空。**

4. 查询标签的flushCache="false"，表示查询不进行缓存的清除，如果将其设置为false,则一级缓存和二级缓存进行清除。

5. sqlSession.clearCache()只清除当前会话的一级缓存。

6. localCacheScope:本地缓存作用域(一级缓存作用域)，默认为SESSION。

   ​	SESSION：当前会话的所有数据会被缓存到SESSION的缓存中。

   ​	STATMENT:可以禁用一级缓存。	

#### 四. MyBatis的缓存原理

​	

#### 五. 整合EhCache

​	